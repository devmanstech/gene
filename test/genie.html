<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Genie unit tests</title>
    <script src="../genie.js"></script>
    <script src="evidence.js"></script>
  </head>
  <body>
    <h1>Genie unit tests</h1>
    <p>
      Your wish is my command...<br />
      See the browser console for results.
    </p>
    
    <script>
      function prepForTest() {
        genie.clearWishes();
      }
      
      function registerBlankWish(magicWords) {
        genie(magicWords,function (){});
      }
      
      Evidence.TestCase.extend('GenieTest', {
        testWishRegistration: function(t) {
          prepForTest();
          var wishCalled = 0;
          var wish = genie('wish', function() {
            wishCalled++;
          });
          t.assertEqual(wishCalled, 0);
          
          genie.makeWish(wish);
          t.assertEqual(wishCalled, 1);
          
          genie.deregisterWish(wish);
          genie.makeWish(wish);
          t.assertEqual(wishCalled, 1);
        },
        testClearingWishes: function(t) {
          prepForTest();
          var wishCalled = 0;
          var wish = genie('wish', function() {
            wishCalled++;
          });
          genie.clearWishes();
          genie.makeWish(wish);
          t.assertEqual(wishCalled, 0);
        },
        testMagicWords: function(t) {
          prepForTest();
          registerBlankWish('Lord of the Flies');
          registerBlankWish('Pirates of the Carribean');
          registerBlankWish('Lord of the Rings');
          
          var ofTheWishes = genie.getMatchingWishes('of the');
          t.assertEqual(ofTheWishes.length, 3);
          
          var lordWishes = genie.getMatchingWishes('Lord of the');
          t.assertEqual(lordWishes.length, 2);
          
          var ringWishes = genie.getMatchingWishes('Ring');
          t.assertEqual(ringWishes.length, 1);
        },
        testMultipleMagicWords: function(t) {
          prepForTest();
          registerBlankWish(['Book', 'Music', 'Movie']);
          registerBlankWish(['Cat', 'Dog', 'Goat']);
          
          var bookWish = genie.getMatchingWishes('b');
          var mWish = genie.getMatchingWishes('m');
          var movieWish = genie.getMatchingWishes('movie');
          t.assertEqual(bookWish.length, 1);
          t.assertEqual(mWish.length, 1);
          t.assertEqual(movieWish.length, 1);
          t.assertIdentical(bookWish[0], mWish[0]);
          t.assertIdentical(mWish[0], movieWish[0]);


          var catWish = genie.getMatchingWishes('cat');
          var dWish = genie.getMatchingWishes('d');
          var tWish = genie.getMatchingWishes('t');
          t.assertEqual(catWish.length, 1);
          t.assertEqual(dWish.length, 1);
          t.assertEqual(tWish.length, 1);
          t.assertIdentical(catWish[0], dWish[0]);
          t.assertIdentical(dWish[0], tWish[0]);
          
          var oWishes = genie.getMatchingWishes('o');
          t.assertEqual(oWishes.length, 2);
          t.assertFalse(oWishes[0] === oWishes[1]);
        }
      });
    </script>
  </body>
</html>
