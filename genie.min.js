/** 
 * genie - v0.3.0 @license
 * (c) 2014-01-01 - Kent C. Dodds <kent@doddsfamily.us>
 * A JavaScript library committed to improving user experience by empowering users to interact with web apps using the keyboard (better than cryptic shortcuts).
 * Freely distributed under the MIT license
 * https://github.com/kentcdodds/genie
 */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(b):a.genie=b()}(this,function(){"use strict";function a(c){if(N(c)){var e=[];return K(c,function(b){e.push(a(b))}),e}var f=c.id||"g-"+ib++,g={id:f,context:b(c.context),data:c.data||{},magicWords:C(c.magicWords),action:d(c.action)};return g.data.timesMade={total:0,magicWords:{}},hb[f]=g,hb[f]}function b(a){var b=a||kb;return b=O(b)||N(b)?{any:C(b)}:c(a)}function c(a){function b(b){a[b]&&(a[b]=C(a[b]))}return b("all"),b("any"),b("none"),a}function d(a){return O(a)&&(a={destination:a}),P(a)?function(){a.openNewTab?window.open(a.destination,"_blank"):window.location.href=a.destination}:a}function e(a){P(a)&&a.id&&(a=a.id);var b=hb[a];return delete hb[a],K(jb,function(b,c){-1!==b.indexOf(a)&&jb[c].splice(b.indexOf(a),1),jb[c].length||delete jb[c]}),b}function f(a,b,c){var d=h(a,b,c);return K(d,function(a,b){d[b]=e(a)}),d}function g(a){a=a||kb;var b=[];return K(hb,function(c){(v(a)||v(c.context)||x(c,a))&&b.push(c)}),b}function h(a,b,c){var d=[];return b=b||"any",K(hb,function(e){var f=i(e,c);!J(f)&&("all"===b&&H(f,a)||"none"===b&&G(f,a)||"any"===b&&F(f,a))&&d.push(e)}),d}function i(a,b){var c=[];return b=b||["all","any","none"],b=C(b),K(b,function(b){a.context[b]&&(c=c.concat(a.context[b]))}),c}function j(a){if(N(a)){var b=[];return K(a,function(a){b.push(hb[a])}),b}return hb[a]}function k(){var a=U();return U({wishes:{},noWishMerge:!0,previousId:0,enteredMagicWords:{},context:kb,previousContext:kb,enabled:!0}),a}function l(a){a=a||"";var b=jb[a]||[],c=m(b,a);b=b.concat(c);var d=[];return K(b,function(a){var b=hb[a];b&&w(b)&&d.push(b)}),d}function m(a,b){var c=[],d=[];K(hb,function(d,e){if(!I(a,e)&&w(d)){var f=n(d.magicWords,b);f!==rb.noMatch&&(c[f]=c[f]||[],c[f].push(e))}});for(var e=c.length;e>0;e--){var f=c[e-1];f&&(d=d.concat(f))}return d}function n(a,b){var c=rb.noMatch;return K(a,function(a){var d=o(a,b);return d>c&&(c=d),c!==rb.equals}),c}function o(a,b){return a=(""+a).toLowerCase(),b=(""+b).toLowerCase(),b.length>a.length?rb.noMatch:a===b?rb.equals:0===a.indexOf(b)?rb.startsWith:-1!==a.indexOf(" "+b)?rb.wordStartsWith:-1!==a.indexOf(b)?rb.contains:1===b.length?rb.noMatch:-1!==p(a).indexOf(b)?rb.acronym:q(a,b)}function p(a){var b="",c=a.split(" ");return K(c,function(a){var c=a.split("-");K(c,function(a){b+=a.substr(0,1)})}),b}function q(a,b){function c(a,b){for(var c=!1,e=d;e<b.length;e++){var f=b[e];if(f===a){c=!0,d=e+1;break}}return c}for(var d=0,e=0;e<b.length;e++){var f=b[e],g=c(f,a);if(!g)return rb.noMatch}return rb.matches}function r(a,b){return a=s(a,b),t(a)?(u(a,b),T(b)||y(a,b),a):null}function s(a,b){var c=a;if(P(c)||(c=hb[c]),T(c)){var d=l(b);d.length>0&&(c=d[0])}return c}function t(a){return!R([a,hb[a.id]])&&!T(a.action)&&w(a)}function u(a,b){a.action(a,b);var c=a.data.timesMade;c.total++,c.magicWords[b]=c.magicWords[b]||0,c.magicWords[b]++}function v(a){return P(a)||(a=C(a)),N(a)&&1===a.length?a[0]===kb[0]:a.any&&1===a.any.length?a.any[0]===kb[0]:!1}function w(a){return v(lb)||v(a.context)||a.context===lb||x(a,lb)}function x(a,b){var c,d=a.context.any||[],e=a.context.all||[],f=a.context.none||[],g=J(d)||F(b,d),h=b.length>=e.length&&H(b,e),i=G(b,f);return c=g&&h&&i}function y(a,b){jb[b]=jb[b]||[];var c=a.id,d=jb[b],e=d.indexOf(c);0!==e&&z(c,d,e)}function z(a,b,c){if(-1!==c&&b.splice(c,1),1!==c&&b.length>0){var d=b[0];b[0]=a,a=d}b.unshift(a)}function A(a){var b={add:[],remove:[]};return K(mb,function(c){var d=!1,e=c.contexts,f=c.regexes,g=c.paths;K(f,function(c){c.lastIndex=0;var f=c.exec(a);if(f&&f.length>0){var g=[];K(e,function(a){var b=a.replace(qb,function(a,b){return f[b]});g.push(b)}),b.add=b.add.concat(g),d=!0}return!d}),d||(K(g,function(c){return a===c&&(b.add=b.add.concat(e),d=!0),!d}),d||(b.remove=b.remove.concat(e)))}),b}function B(){var a=[];return K(mb,function(b){var c=b.contexts;K(c,function(b){if(qb.test(b)){var c=b.replace(qb,".+?");K(lb,function(b){new RegExp(c).test(b)&&a.push(b)})}})}),a}function C(a){return a?N(a)?a:[a]:[]}function D(a,b){b=C(b);for(var c=0;c<b.length;c++)a.indexOf(b[c])<0&&a.push(b[c])}function E(a,b){b=C(b);for(var c=0;c<a.length;)I(b,a[c])?a.splice(c,1):c++}function F(a,b){a=C(a),b=C(b);for(var c=0;c<b.length;c++)if(I(a,b[c]))return!0;return!1}function G(a,b){a=C(a),b=C(b);for(var c=0;c<b.length;c++)if(I(a,b[c]))return!1;return!0}function H(a,b){a=C(a),b=C(b);for(var c=0;c<b.length;c++)if(!I(a,b[c]))return!1;return!0}function I(a,b){return a.indexOf(b)>-1}function J(a){return T(a)?!0:N(a)?0===a.length:Q(a)?!1:!1}function K(a,b){Q(a)&&(a=C(a)),N(a)?L(a,b):M(a,b)}function L(a,b){for(var c,d=0;d<a.length&&(c=b(a[d],d,a),"boolean"!=typeof c||c);d++);return c}function M(a,b){var c;for(var d in a)if(a.hasOwnProperty(d)&&(c=b(a[d],d,a),"boolean"==typeof c&&!c))break;return c}function N(a){return a instanceof Array}function O(a){return"string"==typeof a}function P(a){return"object"==typeof a}function Q(a){switch(typeof a){case"string":case"number":case"boolean":case"undefined":return!0;default:return!1}}function R(a){return N(a)?K(a,function(a){return!R(a)}):"undefined"==typeof a}function S(a){return N(a)?K(a,function(a){return!S(a)}):null===a}function T(a){return S(a)||R(a)}function U(a){return a&&(V(a),ib=a.previousId||ib,jb=a.enteredMagicWords||jb,lb=a.context||lb,nb=a.previousContext||nb,ob=a.enabled||ob,pb=a.returnOnDisabled||pb),{wishes:hb,previousId:ib,enteredMagicWords:jb,context:lb,previousContext:nb,enabled:ob}}function V(a){a.wishes&&(a.noWishMerge?hb=a.wishes:W(a.wishes))}function W(a){return K(a,function(a,b){a.id=b,!a.action&&hb[b]&&(a.action=hb[b].action),a.action&&(hb[b]=a)}),hb}function X(a){return void 0!==a&&(nb=lb,"string"==typeof a&&(a=[a]),lb=a),lb}function Y(a){return nb=lb,D(lb,a),lb}function Z(a){return nb=lb,E(lb,a),J(X)&&(lb=kb),lb}function $(){return X(nb)}function _(){return X(kb)}function ab(a,b){if(a){var c=A(a),d=c.add,e=B();e=e.concat(c.remove),Z(e),b||f(e),Y(d)}return lb}function bb(a){return K(a,function(a){a.paths&&(a.paths=C(a.paths)),a.regexes&&(a.regexes=C(a.regexes)),a.contexts&&(a.contexts=C(a.contexts))}),D(mb,a),mb}function cb(a){return E(mb,a),mb}function db(a){return void 0!==a&&(ob=a),ob}function eb(a){return void 0!==a&&(pb=a),pb}function fb(a,b){return function(){return ob||a===db?a.apply(this,arguments):pb?b:null}}var gb=null,hb={},ib=0,jb={},kb=["universe"],lb=kb,mb=[],nb=kb,ob=!0,pb=!0,qb=/\{\{(\d+)\}\}/,rb={equals:6,startsWith:5,wordStartsWith:4,contains:3,acronym:2,matches:1,noMatch:0};return gb=fb(a,{}),gb.getWishesInContext=fb(g,[]),gb.getWishesWithContext=fb(h,[]),gb.getWish=fb(j,{}),gb.getMatchingWishes=fb(l,[]),gb.makeWish=fb(r,{}),gb.options=fb(U,{}),gb.mergeWishes=fb(W,{}),gb.deregisterWish=fb(e,{}),gb.deregisterWishesWithContext=fb(f,[]),gb.reset=fb(k,{}),gb.context=fb(X,[]),gb.addContext=fb(Y,[]),gb.removeContext=fb(Z,[]),gb.revertContext=fb($,[]),gb.restoreContext=fb(_,[]),gb.updatePathContext=fb(ab,[]),gb.addPathContext=fb(bb,[]),gb.removePathContext=fb(cb,[]),gb.enabled=fb(db,!1),gb.returnOnDisabled=fb(eb,!0),gb});