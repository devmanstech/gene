/** 
 * genie - v0.2.5 @license
 * (c) 2013-12-27 - Kent C. Dodds <kent@doddsfamily.us>
 * A JavaScript library committed to improving user experience by empowering users to interact with web apps using the keyboard (better than cryptic shortcuts).
 * Freely distributed under the MIT license
 * https://github.com/kentcdodds/genie
 */
!function(a,b){"function"==typeof define&&define.amd?define(b):a.genie=b()}(this,function(){function a(){return"g-"+T++}function b(d,e,f,g,h){if(Array.isArray(d)){if("object"==typeof d[0]){for(var i=[],j=0;j<d.length;j++)i.push(b(d[j]));return i}}else{if("object"==typeof d)return b(d.magicWords,d.action,d.context,d.data,d.id);d=[d]}void 0===h&&(h=a());for(var j=0;j<d.length;j++)if("object"==typeof d[j])throw"Cannot make an object a magic word!\n"+JSON.stringify(d,null,2);e=c(e);var k={id:h,context:f||V,data:g,magicWords:d,action:e};return S[h]=k,S[h]}function c(a){return"function"==typeof a?a:("string"==typeof a&&(a={destination:a}),function(){a.openNewTab?window.open(a.destination,"_blank"):window.location.href=a.destination})}function d(a){"object"==typeof a&&a.id&&(a=a.id);var b=S[a];delete S[a];for(var c in U)-1!=U[c].indexOf(a)&&U[c].splice(U[c].indexOf(a),1),U[c].length||delete U[c];return b}function e(a){var b=[];for(var c in S)n(S[c],a)&&b.push(d(S[c]));return b}function f(){var a=E();return E({wishes:{},noWishMerge:!0,previousId:0,enteredMagicWords:[],context:V,previousContext:V,enabled:!0}),a}function g(a){var b,c,d,e,f;if(void 0===a)a="";else{if(null===a)return[];if("object"==typeof a)throw"Cannot match wishes to an object!\n"+JSON.stringify(a,null,2)}for(c=U[a]||[],b=h(c,a),c=c.concat(b),d=[],e=0;e<c.length;e++)f=S[c[e]],f&&m(f)&&d.push(f);return d}function h(a,b){var c=[],d=[];for(var e in S)if(-1==a.indexOf(e)){var f=S[e],g=i(f.magicWords,b);g!==bb.noMatch&&(c[g]=c[g]||[],c[g].push(e))}for(var h=c.length;h>0;h--){var j=c[h-1];j&&(d=d.concat(j))}return d}function i(a,b){for(var c=bb.noMatch,d=0;d<a.length;d++){var e=j(a[d],b);if(e>c&&(c=e),c===bb.equals)break}return c}function j(a,b){var c,d,e,f,g="";if(a=(""+a).toLowerCase(),b=(""+b).toLowerCase(),b.length>a.length)return bb.noMatch;if(a===b)return bb.equals;if(0===a.indexOf(b))return bb.startsWith;if(-1!==a.indexOf(" "+b))return bb.wordStartsWith;if(-1!==a.indexOf(b))return bb.contains;if(1===b.length)return bb.noMatch;for(c=a.split(" "),e=0;e<c.length;e++)for(d=c[e].split("-"),f=0;f<d.length;f++)g+=d[f].substr(0,1);return-1!=g.indexOf(b)?bb.acronym:k(a,b)}function k(a,b){for(var c=0,d=0;d<b.length;d++){for(var e=b[d],f=!1,g=c;g<a.length;g++){var h=a[g];if(h==e){f=!0,c=g+1;break}}if(!f)return bb.noMatch}return bb.matches}function l(a,b){var c,d,e,f,h;if("object"!=typeof a&&(a=S[a]),(null===a||void 0===a)&&(h=g(b),h.length>0&&(a=h[0])),!(a&&S[a.id]&&a.action&&m(a)))return null;if(a.action(a),void 0!==b){if(U[b]=U[b]||[],c=a.id,d=U[b],e=d.indexOf(c),0===e)return a;-1!=e&&d.splice(e,1),1!=e&&d.length>0&&(f=d[0],d[0]=c,c=f),d.unshift(c)}return a}function m(a){var b=W===V,c=a.context===V,d=a.context===W;return b||c||d?!0:n(a,W)}function n(a,b){var c=!1,d=!1;if(a.context.all||a.context.none||a.context.any){var e=a.context.all||[],f=a.context.none||[],g=a.context.any||[],h=x(g)||t(b,g),i=b.length>=e.length&&v(b,e),j=u(b,f);c=h&&i&&j}else d=t(b,a.context);return d||c}function o(a){var b={add:[],remove:[]};return y(X,function(c){var d=!1,e=q(c.contexts),f=q(c.regexes),g=q(c.paths);y(f,function(c){c.lastIndex=0;var f=c.exec(a);if(f&&f.length>0){var g=[];_.each(e,function(a){var b=a.replace(ab,function(a,b){return f[b]});g.push(b)}),b.add=b.add.concat(g),d=!0}return!d}),d||(y(g,function(c){return a===c&&(b.add=b.add.concat(e),d=!0),!d}),d||(b.remove=b.remove.concat(e)))}),b}function p(){var a=[];return y(X,function(b){var c=b.contexts;y(c,function(b){if(ab.test(b)){var c=b.replace(ab,".+?");y(W,function(b){new RegExp(c).test(b)&&a.push(b)})}})}),a}function q(a){return a?z(a)?a:[a]:[]}function r(a,b){b=q(b);for(var c=0;c<b.length;c++)a.indexOf(b[c])<0&&a.push(b[c])}function s(a,b){b=q(b);for(var c=0;c<a.length;)w(b,a[c])?a.splice(c,1):c++}function t(a,b){a=q(a),b=q(b);for(var c=0;c<b.length;c++)if(w(a,b[c]))return!0;return!1}function u(a,b){a=q(a),b=q(b);for(var c=0;c<b.length;c++)if(w(a,b[c]))return!1;return!0}function v(a,b){a=q(a),b=q(b);for(var c=0;c<b.length;c++)if(!w(a,b[c]))return!1;return!0}function w(a,b){return a.indexOf(b)>-1}function x(a){return D(a)?!0:z(a)?0===a.length:A(a)?!1:!1}function y(a,b){if(A(a)&&(a=q(a)),z(a))for(var c=0;c<a.length;c++){var d=b(a[c],c,a);if("boolean"==typeof d&&!d)break}else for(var e in a){var d=b(a[e],e,a);if("boolean"==typeof d&&!d)break}}function z(a){return a instanceof Array}function A(a){switch(typeof a){case"string":case"number":case"boolean":case"undefined":return!0;default:return!1}}function B(a){return"undefined"==typeof a}function C(a){return null===a}function D(a){return C(a)||B(a)}function E(a){return a&&(a.wishes&&(a.noWishMerge?S=a.wishes:F(a.wishes)),T=a.previousId||T,U=a.enteredMagicWords||U,W=a.context||W,Y=a.previousContext||Y,Z=a.enabled||Z,$=a.returnOnDisabled||$),{wishes:S,previousId:T,enteredMagicWords:U,context:W,previousContext:Y,enabled:Z}}function F(a){var b;for(var c in a)b=a[c],b.action||S[c]&&(b.action=S[c].action),b.action&&(S[c]=b);return S}function G(a){return void 0!==a&&(Y=W,"string"==typeof a&&(a=[a]),W=a),W}function H(a){return Y=W,r(W,a),W}function I(a){return Y=W,s(W,a),W}function J(){return G(Y)}function K(){return G(V)}function L(a,b){if(a){var c=o(a),d=c.add,f=p();f=f.concat(c.remove),I(f),b||e(f),H(d)}return W}function M(a){return r(X,a),X}function N(a){return s(X,a),X}function O(a){return void 0!==a&&(Z=a),Z}function P(a){return void 0!==a&&($=a),$}function Q(a,b){return function(){return Z||a===O?a.apply(this,arguments):$?b:null}}var R=null,S={},T=0,U={},V=["universe"],W=V,X=[],Y=V,Z=!0,$=!0,ab=/\{\{(\d+)\}\}/,bb={equals:6,startsWith:5,wordStartsWith:4,contains:3,acronym:2,matches:1,noMatch:0};return R=Q(b,{}),R.getMatchingWishes=Q(g,[]),R.makeWish=Q(l,{}),R.options=Q(E,{}),R.mergeWishes=Q(F,{}),R.deregisterWish=Q(d,{}),R.deregisterWishesWithContext=Q(e,[]),R.reset=Q(f,{}),R.context=Q(G,[]),R.addContext=Q(H,[]),R.removeContext=Q(I,[]),R.revertContext=Q(J,[]),R.restoreContext=Q(K,[]),R.updatePathContext=Q(L,[]),R.addPathContext=Q(M,[]),R.removePathContext=Q(N,[]),R.enabled=Q(O,!1),R.returnOnDisabled=Q(P,!0),R});